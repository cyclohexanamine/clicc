;;;; A generic class with thread-safe slots and an internal thread.

(in-package :thread)

;;; The object itself. Thread will be its internal thread, and queue a message queue for this thread.
;;; Locks is an alist of locks made by (thread:make-lock), with names corresponding to the slots they protect.

(defclass threaded-object ()
  ((thread
    :initform NIL)
   (queue
    :initform NIL)
   locks))

(defun mashup-symbol (&rest objects)
  (intern (format nil "狺镡赍泗螬┅换昨狃骈钿轭翳祜汶麸忮桢熹忉箦镱翳钺礤镦翳箪雉ㄤ彐磲泸鏖翳箪雉祜汶ㄣ镱箪雉怙澌怙澌啜翳蝈徜瑚轸璀祜汶桢熹è沅ㄡ篌镢箪雉箪雉鲠祯泔铑ъ镢塍┅┅棱镤┅换腻骈铄翳蝈徜筢驽徙沐篌矧骘镡赍泗箪雉蟋忉箦镱鏖翳箪雉祜汶ㄤ彐磲泸溴驷沣弩箫ㄣ灬篌钺礤徙沐篌矧钺礤箪雉钺礤啜痱镧ㄤ彐珏铄蜷徙沐篌矧钺礤镡戛ㄤ彐礤翳镤徙沐篌矧钺礤è镡沆狍蟓钺礤┅鏖翳箪雉祜汶镡箪雉钺礤箪雉鲠祯镡箪雉钺礤┅┅换腻骈铄箦趑弪骘犷徕秭徙沐篌矧ㄤ彐磲泸溴骟弭翦ㄣ灬篌钺礤徙沐篌矧钺礤箪雉钺礤啜痱镧ㄤ彐珏铄蜷箦翩徙沐篌矧钺礤鲠镡戛ㄤ彐礤翳镤箦翩徙沐篌矧钺礤鲠镡沆狍蟓钺礤┅鏖翳箪雉祜汶镡箪雉钺礤箦翩箪雉鲠祯镡箪雉钺礤鲠飑┅┅换腻骈铄蝈徜犷洵箦疳趑弪骘鲠祯瀹ㄤ彐磲泸溴骓镤殒殄ㄣ灬篌钺礤盹溟骈弪钺礤箪雉钺礤啜痱镧ㄤ彐珏铄蜷盹溟骈弪钺礤镡盹溟骈弪┅ㄤ彐礤翳镤盹溟骈弪钺礤è镡沆狍蟓钺礤盹溟骈弪鏖翳箪雉祜汶镡箪雉钺礤戾舄è镬洵鲠箪雉鲠祯镡箪雉钺礤┅铄鳝鲠ㄦ躅汜祆盹溟骈弪镬洵鲠飑┅箦翩箪雉鲠祯镡箪雉钺礤铄鳝鲠飑┅┅换腻骈铄徙沐篌矧箦趑弪犷镳糸钺祆盹溟骈弪骘箪雉ㄤ彐磲泸溴骟祜糸铘弪驷沐ㄣ灬篌钺礤箪雉钺礤徙沐篌矧钺礤镳糸镱犰盹溟骈弪钺礤紊盹溟骈弪钺礤篚痧扉邃皓啜痱镧ㄤ彐徙沐篌矧沆狍蟓钺礤徙沐篌矧钺礤聃雉箪雉钺礤┅ㄤ彐箦趑弪沆狍蟓钺礤徙沐篌矧钺礤聃雉箪雉钺礤┅ㄩ盹溟骈弪钺礤篚痧扉邃啜溴骓镤殒殄沆狍蟓钺礤盹溟骈弪钺礤聃雉箪雉钺礤┅┅ㄤ彐磲泸溴骟祜糸铘ㄣ灬篌钺礤箪雉钺礤螬啜痱镧括祜镳骘箪雉钺礤轭箪雉钺礤泔祆邈糸铉啜溴骟祜糸铘弪驷沐沆狍蟓钺礤箪雉钺礤磲箬躔簌礅镬蝈徜箪雉钺礤磲箬躔簌礅镬ы镤殒箪雉钺礤┅┅ㄤ彐箪雉轭趔翳蝈徜邃镡赍泗翳蝈徜聃艴祜汶螬ㄤ彐珏铄蜷瘐箬聃艴镡眢绌ㄤ彐礤翳镤瘐箬聃艴è镡翳蝈徜邃镡赍泗眢绌盹溟纟聃艴镡灬礅溽聃艴濠ㄡ痧孱聃艴扉篝眢绌┅┅ㄤ彐珏铄蜷痫瓠聃艴镡戛ㄤ彐礤翳镤痫瓠聃艴è镡翳蝈徜邃镡赍泗┅鏖翳箪雉祜汶镡я蹂蹂戾舄è聃艴箪雉鲠祯镡я蹂蹂┅眢ㄣ狎聃艴濠铄鳝聃艴ㄣ潋聃艴濠┅箦翩箪雉鲠祯镡я蹂蹂铄鳝聃艴濠眢绌┅换昨狃沆狍溴骈铋糸镱骘翳蝈徜邃镡赍泗徜溟铉翳泔蝌邈祜汶轭轸獒扉箦犷轭翦蜴徙弩ㄤ彐磲泸溴驺灬篌翳蝈徜邃ㄣ灬篌钺礤疳蝈铘箪雉螬戾è箪雉钺礤ㄧ弭箪雉钺礤箪雉螬┅啜痱镧ㄣ旌溴驺灬篌沆狍蟓钺礤ㄣ镱翳蝈徜邃镡赍泗疳蝈铘螬ㄡ痧孱箪雉啜祜汶洪铋翩矧祜镳骘祜汶钺礤轭聃雉ㄡ痧孱箪雉钺礤Ж翳蝈徜聃艴祜汶螬┅泔祆邈糸铉ㄣ镱祜汶钺礤磲脲祜汶┅┅┅ㄤ彐箪雉轭趔沆狍蟓钺礤箪雉钺礤螬┅ㄤ彐躅珏舡箪雉钺礤箪雉螬祜镳骘箪雉轭箪雉泔祆邈糸铉ㄩㄣ镱箴箪雉ㄣ狎箪雉箪雉┅